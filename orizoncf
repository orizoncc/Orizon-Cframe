local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local StarterGui = game:GetService("StarterGui")
local UserInputService = game:GetService("UserInputService")
local CoreGui = game:GetService("CoreGui")

local Cframe = {}
Cframe.enabled = false
Cframe.speed = 5

local OrizonCFrame = Instance.new("ScreenGui")
local Frame = Instance.new("Frame")
local UICorner = Instance.new("UICorner")
local TextButton = Instance.new("TextButton")
local UICorner_2 = Instance.new("UICorner")

OrizonCFrame.Name = "OrizonCFrame"
OrizonCFrame.Parent = CoreGui
OrizonCFrame.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

Frame.Parent = OrizonCFrame
Frame.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
Frame.BorderSizePixel = 0
Frame.Position = UDim2.new(0.5, -55, 0.5, -25)
Frame.Size = UDim2.new(0, 110, 0, 50)
Frame.Active = true
Frame.Draggable = true
UICorner.Parent = Frame

TextButton.Parent = Frame
TextButton.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
TextButton.BorderSizePixel = 0
TextButton.Position = UDim2.new(0, 5, 0, 5)
TextButton.Size = UDim2.new(0, 100, 0, 40)
TextButton.Font = Enum.Font.GothamBlack
TextButton.Text = "CFrame OFF"
TextButton.TextColor3 = Color3.fromRGB(255, 255, 255)
TextButton.TextScaled = true
UICorner_2.Parent = TextButton

local function handleCFrameMovement()
    if Cframe.enabled and Players.LocalPlayer.Character and Players.LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then
        local humanoid = Players.LocalPlayer.Character:FindFirstChild("Humanoid")
        local humanoidRootPart = Players.LocalPlayer.Character.HumanoidRootPart

        if humanoid and humanoid:GetState() ~= Enum.HumanoidStateType.Freefall then
            local moveDirection = humanoid.MoveDirection
            if moveDirection.Magnitude > 0 then
                humanoidRootPart.AssemblyLinearVelocity = humanoidRootPart.AssemblyLinearVelocity + moveDirection * Cframe.speed
            end
        end
    end
end

TextButton.MouseButton1Click:Connect(function()
    Cframe.enabled = not Cframe.enabled
    TextButton.Text = Cframe.enabled and "CFrame ON" or "CFrame OFF"
end)

local lastCommandTime = 0

Players.LocalPlayer.Chatted:Connect(function(message)
    local args = message:split(" ")
    if args[1]:lower() == "/cframe" then
        local currentTime = tick()
        if currentTime - lastCommandTime < 0.5 then return end
        lastCommandTime = currentTime

        local speed = tonumber(args[2])
        if speed then
            if speed > 50 then
                StarterGui:SetCore("SendNotification", {
                    Title = "Error";
                    Text = "The speed limit is 50!";
                    Duration = 3;
                })
            elseif speed > 0 then
                Cframe.speed = speed
                StarterGui:SetCore("SendNotification", {
                    Title = "CFrame Speed Applied";
                    Text = "Speed set to " .. tostring(Cframe.speed);
                    Duration = 3;
                })
            else
                StarterGui:SetCore("SendNotification", {
                    Title = "Error";
                    Text = "Speed must be greater than 0!";
                    Duration = 3;
                })
            end
        else
            StarterGui:SetCore("SendNotification", {
                Title = "Error";
                Text = "Invalid speed value!";
                Duration = 3;
            })
        end
    end
end)

UserInputService.InputBegan:Connect(function(input, gameProcessed)
    if gameProcessed then return end
    if input.KeyCode == Enum.KeyCode.LeftControl then
        Cframe.enabled = not Cframe.enabled
        TextButton.Text = Cframe.enabled and "CFrame ON" or "CFrame OFF"
    end
end)

StarterGui:SetCore("SendNotification", {
    Title = "CFrame Controls";
    Text = "PC: Ctrl to toggle c frame | Chat Commands: /cframe <speed>";
    Duration = 5;
})

RunService.RenderStepped:Connect(handleCFrameMovement)
